const waterfallFlowJs_1_25_1=document.querySelector('.waterfallFlowJs_1_25_1');const openProduct=document.querySelector('.openProduct');const openProduct_box_btn=document.querySelector('.openProduct_box_btn');const openProductShoppingCart=document.querySelector('.openProductShoppingCart');const openProductShoppingCart_btn=document.querySelector('.openProductShoppingCart_btn');const waterfallFlowJs_1_25_2=document.querySelector('.waterfallFlowJs_1_25_2');const openProductNov_sev=document.querySelector('.openProductNov_sev');const GITHUB_TOKEN_openProductShoppingCart_going='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';const GIST_ID__openProductShoppingCart_going='1ca7ee625bd9f0385ce36dba701f51f6';const FILE_NAME_openProductShoppingCart_going='html_shoppingCart.txt';const submitButton=document.querySelector('.openProductShoppingCart button');const titleElement=document.querySelector('.openProductShoppingCart_title');const imgElement_Cart=document.querySelector('.openProductShoppingCart_productDetails img');const addressInput=document.querySelector('.openProductShoppingCart_input');const titleElement_Cart=document.querySelector('.openProductShoppingCart_productDetails span div:nth-child(2)');const priceElement_Cart=document.querySelector('.openProductShoppingCart_productDetails span div:nth-child(1)');submitButton.addEventListener('click',async()=>{const accountId=accountIdElement.textContent.trim();const address=addressInput.value.trim();if(accountId===''){titleElement.textContent='请先进行登录';titleElement.style.display='block';setTimeout(()=>{titleElement.style.display='none'},2000);return}if(address===''){titleElement.textContent='请填写收件人地址';titleElement.style.display='block';setTimeout(()=>{titleElement.style.display='none'},2000);return}try{const response=await fetch(`https:headers:{Authorization:`Bearer ${GITHUB_TOKEN_openProductShoppingCart_going}`}});if(!response.ok){throw new Error(`请求失败，状态码:${response.status}`)}const gistData=await response.json();const fileContent=gistData.files[FILE_NAME_openProductShoppingCart_going].content;let existingOrders=[];if(fileContent.trim()!==''){try{existingOrders=JSON.parse(fileContent)}catch(parseError){console.error('解析 Gist 文件内容时出现错误:',parseError);existingOrders=[]}}let orderNumber;do{const today=new Date();const datePart=today.toISOString().slice(0,10).replace(/-/g,'');const randomPart=Math.floor(Math.random()*900)+100;orderNumber=`JY${datePart}${randomPart}`}while(existingOrders.some(order=>order.订单号===orderNumber));const newOrder={账号:accountId,订单号:orderNumber,图片:imgElement_Cart.src,地址:address,标题:titleElement_Cart.textContent,金额:parseFloat(priceElement_Cart.textContent.replace('￥',''))};existingOrders.push(newOrder);const updatedContent=JSON.stringify(existingOrders,null,2);const updateResponse=await fetch(`https:method:'PATCH',headers:{Authorization:`Bearer ${GITHUB_TOKEN_openProductShoppingCart_going}`,'Content-Type':'application/json'},body:JSON.stringify({files:{[FILE_NAME_openProductShoppingCart_going]:{content:updatedContent}}})});if(!updateResponse.ok){throw new Error(`更新Gist失败，状态码:${updateResponse.status}`)}titleElement.textContent='已加入购物车';titleElement.style.display='block';setTimeout(()=>{titleElement.style.display='none'},2000);return}catch(error){console.error('写入数据时出现错误:',error)}});openProductNov_sev.addEventListener('click',()=>{platform_customer_service.style.visibility='visible';platform_customer_service.style.opacity='1'});openProductShoppingCart_btn.addEventListener('click',()=>{openProductShoppingCart.style.visibility='hidden';openProductShoppingCart.style.opacity='0'});openProduct_box_btn.addEventListener('click',()=>{openProduct.style.visibility='hidden';openProduct.style.opacity='0'});const GITHUB_TOKEN_openProductNov_shop='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';const GIST_ID_openProductNov_shop='64b0d117f57199212b58927264bf81d6';const FILE_NAME_openProductNov_shop='html_receiveAddress';const shopButton=document.querySelector('.openProductNov_shop');const accountIdElement=document.querySelector('.Account_id_userName');const inputElement=document.querySelector('.openProductShoppingCart_input');shopButton.addEventListener('click',async()=>{openProductShoppingCart.style.visibility='visible';openProductShoppingCart.style.opacity='1';const accountId=accountIdElement.textContent.trim();try{const response=await fetch(`https:headers:{Authorization:`Bearer ${GITHUB_TOKEN_openProductNov_shop}`}});if(!response.ok){throw new Error(`请求失败，状态码:${response.status}`)}const gistData=await response.json();const fileContent=gistData.files[FILE_NAME_openProductNov_shop].content;const addressData=JSON.parse(fileContent);if(addressData.hasOwnProperty(accountId)){inputElement.value=addressData[accountId]}else{inputElement.value=''}}catch(error){console.error('获取数据时出现错误:',error)}});waterfallFlowJs_1_25_1.addEventListener('click',()=>{openProduct.style.visibility='visible';openProduct.style.opacity='1';const data={图片:'https://example.com/product.jpg',金额:'￥5000',标题:'苹果手机 银色12GB+256GB',规格:['金色12GB+256GB','金色12GB+512GB','黑色12GB+256GB','黑色12GB+512GB'],规格对应图片:{'金色12GB+256GB':'https://example.com/gold_256.jpg','金色12GB+512GB':'https://example.com/gold_512.jpg','黑色12GB+256GB':'https://example.com/black_256.jpg','黑色12GB+512GB':'https://example.com/black_512.jpg'},规格对应金额:{'金色12GB+256GB':'￥5500','金色12GB+512GB':'￥6000','黑色12GB+256GB':'￥5500','黑色12GB+512GB':'￥6000'}};const imgElement=document.querySelector('.openProductShoppingCart_productDetails img');const priceElement=document.querySelector('.openProductShoppingCart_productDetails span div:nth-child(1)');const titleElement=document.querySelector('.openProductShoppingCart_productDetails span div:nth-child(2)');const specListElement=document.querySelector('.openProductShoppingCart ul');imgElement.src=data['图片'];priceElement.textContent=data['金额'];titleElement.textContent=data['标题'];specListElement.innerHTML='';let firstListItem;data['规格'].forEach(spec=>{const listItem=document.createElement('li');listItem.textContent=spec;specListElement.appendChild(listItem);if(!firstListItem){firstListItem=listItem}listItem.addEventListener('click',function(){const allListItems=specListElement.querySelectorAll('li');allListItems.forEach(item=>{item.style.borderColor=''});imgElement.src=data['规格对应图片'][spec]||data['图片'];const baseTitle=data['标题'].replace(/\s*(金色|黑色)12GB\+(256|512)GB\s*$/,'').trim();titleElement.textContent=`${baseTitle}${spec}`;priceElement.textContent=data['规格对应金额'][spec]||data['金额'];listItem.style.borderColor='#E2231A'})});if(firstListItem){firstListItem.click()}});waterfallFlowJs_1_25_2.addEventListener('click',()=>{openProduct.style.visibility='visible';openProduct.style.opacity='1';const data={图片:'https://example.com/product.jpg',金额:'￥5000',标题:'测试第二组',规格:['第一规格','第二规格'],规格对应图片:{'第一规格':'https://example.com/gold_256.jpg','第二规格':'https://example.com/gold_512.jpg'},规格对应金额:{'第一规格':'￥10','第二规格':'￥60'}};const imgElement=document.querySelector('.openProductShoppingCart_productDetails img');const priceElement=document.querySelector('.openProductShoppingCart_productDetails span div:nth-child(1)');const titleElement=document.querySelector('.openProductShoppingCart_productDetails span div:nth-child(2)');const specListElement=document.querySelector('.openProductShoppingCart ul');imgElement.src=data['图片'];priceElement.textContent=data['金额'];titleElement.textContent=data['标题'];specListElement.innerHTML='';let firstListItem;data['规格'].forEach(spec=>{const listItem=document.createElement('li');listItem.textContent=spec;specListElement.appendChild(listItem);if(!firstListItem){firstListItem=listItem}listItem.addEventListener('click',function(){const allListItems=specListElement.querySelectorAll('li');allListItems.forEach(item=>{item.style.borderColor=''});imgElement.src=data['规格对应图片'][spec]||data['图片'];const baseTitle=data['标题'].replace(/\s*(金色|黑色)12GB\+(256|512)GB\s*$/,'').trim();titleElement.textContent=`${baseTitle}${spec}`;priceElement.textContent=data['规格对应金额'][spec]||data['金额'];listItem.style.borderColor='#E2231A'})});if(firstListItem){firstListItem.click()}});
